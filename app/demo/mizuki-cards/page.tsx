"use client";

import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";
import { AnimatePresence, motion } from "motion/react";
import { useState } from "react";

const ITEM_COUNT = 100;
const COLUMNS = 10;
const ROWS = 10;
const MAX_DIAGONAL = COLUMNS - 1 + (ROWS - 1);
const STAGGER_DELAY_S = 0.03; // 30ms per diagonal
const TILE_DURATION_S = 0.4;

export default function MizukiCardsPage() {
  const [isReveal, setIsReveal] = useState(true);
  const toggleReveal = () => setIsReveal((prev) => !prev);

  return (
    <div className="relative isolate flex h-svh w-full flex-col items-center gap-2 py-4">
      <Wave className="absolute bottom-0 left-0 -z-1" />
      <header className="flex w-full items-center justify-between gap-2 px-4">
        <BiwaTerrace />
        <div className="flex items-end">
          <LilyPadIcon className="size-10 rotate-180 rounded-full border-2 border-black" />
          <Button
            onClick={toggleReveal}
            className={cn(
              "size-16 cursor-pointer rounded-full bg-cyan-500 transition-transform hover:bg-cyan-500 active:scale-95",
              isReveal && "bg-cyan-800 hover:bg-cyan-800",
            )}
            size="icon"
          >
            <LilyPadIcon />
          </Button>
          <MizuIcon />
        </div>
      </header>
      {/* Stacked on mobile, equal column if there's enough room, 1/3 and 2/3 on landscape */}
      <div className="w-full px-4">
        <main className="grid-stack w-full gap-4 lg:grid-cols-2 xl:grid-cols-3">
          <div className="aspect-5/7 w-full rounded-xl bg-cyan-500" />
          <div className="aspect-5/7 w-full rounded-xl bg-cyan-500/50 lg:col-start-2 xl:col-span-2 xl:aspect-10/7">
            <MizukiCardsGrid isReveal={isReveal} />
          </div>
        </main>
      </div>
    </div>
  );
}

function MizukiCardsGrid({
  className,
  isReveal,
}: {
  className?: string;
  isReveal: boolean;
}) {
  const initialItems = generateItems(ITEM_COUNT);

  return (
    <div className={cn("grid size-full grid-cols-10 grid-rows-10", className)}>
      {initialItems.map((item) => {
        const rowStart = Math.floor(item.id / COLUMNS) + 1; // 1-based
        const colStart = (item.id % COLUMNS) + 1; // 1-based

        return (
          <MizukiCardsGridItem
            key={item.id}
            item={item}
            isReveal={isReveal}
            rowStart={rowStart}
            colStart={colStart}
          />
        );
      })}
    </div>
  );
}

function MizukiCardsGridItem({
  item,
  isReveal,
  colStart,
  rowStart,
}: {
  item: { id: number };
  isReveal: boolean;
  colStart: number;
  rowStart: number;
}) {
  // Diagonal wave: (0,0)=0, then (0,1)&(1,0)=1, then ...
  const diagonal = rowStart - 1 + (colStart - 1);

  // Enter: top-left -> bottom-right. Exit: bottom-right -> top-left.
  const enterDelay = diagonal * STAGGER_DELAY_S;
  const exitDelay = (MAX_DIAGONAL - diagonal) * STAGGER_DELAY_S;

  return (
    <AnimatePresence>
      {isReveal && (
        <motion.div
          key={item.id}
          initial={{ opacity: 0, scale: 0.5 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: TILE_DURATION_S, delay: enterDelay }}
          exit={{
            opacity: 0,
            scale: 0.5,
            transition: { duration: TILE_DURATION_S, delay: exitDelay },
          }}
          style={{ gridColumnStart: colStart, gridRowStart: rowStart }}
          className={cn("flex size-full items-center justify-center")}
        >
          <a className="flex aspect-5/7 w-full cursor-pointer items-center justify-center rounded-sm bg-white/50 text-center font-black text-white transition-colors duration-200 active:scale-95">
            {item.id + 1}
          </a>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

function generateItems(count: number) {
  const items = [];
  for (let i = 0; i < count; i++) {
    items.push({ id: i });
  }
  return items;
}

function LilyPadIcon({ className }: { className?: string }) {
  return (
    <svg className={cn("size-16", className)} viewBox="0 0 64 64">
      <circle cx="32" cy="32" r="32" fill="#000" />
      <path
        d="M29.45,7.126c-11.616,1.15-21.026,10.466-22.296,22.07-.481,4.396.186,8.588,1.731,12.328.364.881,1.418,1.247,2.243.768l20.295-11.784c1.549-.899,3.147,1.091,1.935,2.409l-15.879,17.26c-.646.702-.517,1.811.266,2.356,4.651,3.236,10.45,4.937,16.667,4.354,11.749-1.101,21.279-10.554,22.46-22.295,1.592-15.829-11.595-29.031-27.419-27.465Z"
        fill="#8ae6d7"
      />
    </svg>
  );
}

function Wave({ className }: { className?: string }) {
  return (
    <svg className={cn("aspect-8/1 w-full", className)} viewBox="0 0 512 64">
      <path
        d="M0,24c25.599,0,25.599,16,51.198,16s25.6-16,51.199-16,25.599,16,51.198,16,25.6-16,51.2-16,25.598,16,51.197,16,25.599-16,51.198-16,25.6,16,51.2,16,25.599-16,51.199-16,25.603,16,51.206,16,25.603-16,51.206-16"
        fill="none"
        stroke="#5bb0cd"
        strokeWidth="12"
      />
    </svg>
  );
}

function BiwaTerrace({ className }: { className?: string }) {
  return (
    <svg className={cn("w-32", className)} viewBox="0 0 432.12 202.43">
      <path
        fill="#000"
        d="M292.62 200.75C251.2 202.45 39 212.08 60.24 155.94c1.15-4.82-2.11-7.53-7.1-6.82-11.45 2.7-23.48 5.53-34.71.5C.8 142.13-5.71 118.59 5.67 103c6.45-8.88 17.52-12.07 26.46-17.7C64.65 66 16.73 26.15 57.4 6.61c20.75-11.45 37.47 7.85 58.29 6.08 34.15-2.09 69.56-21.4 103.6-7.97 12.58 4.78 24.88 13.22 38.67 13.03 20.43-2.3 38.44-15.96 59.8-13.06 45.6 2.4 67.38 17.14 74.5 62.93.98 17 14.44 13.42 26.08 17.48 23.39 10.84 14.62 51.22-8.65 56.96-5.46 1.45-13.65.02-15.56 6.4-1.32 6.73 7.15 11.49 5.68 18.26-16.68 29.47-76.58 28.74-107.2 34.03"
      />
      <path
        fill="#fff"
        d="M95.2 125.55c-35.58-23.9-30.15 8.76-59.56 9.3-14.1-1.91-18.24-20.95-6.55-28.91a19.4 19.4 0 0 1 10.93-4.52 33.43 33.43 0 0 0 29.4-38.84c-1-8.02-7.03-14.82-7-23.08-.78-9.15 8.46-17.22 17.32-15.93 10.46.8 9.73 14.16 19.65 14.52 12.39-1.39 22.4-14.37 35.8-11.1 22.51 2.09 24.02 38.8 3.32 47.23-3.77 2.37-8.74 1.87-12.35 4.26-2.25 2.03-1.4 5.44.68 7.43 29.43 20.12-5.92 53.51-31.64 39.64Zm13.3-60.27c6.9-1.4 30.04-7.22 23.94-17.31-6.57-4.28-14.38.34-20.83 2.42a70 70 0 0 0-12.48 5.75c-10.31 8 1.87 11 9.37 9.14m-6.02 41.35c19.28-5.94 4.05-26.4-10.24-15.68-8.96 6.8.73 18.51 10.24 15.68M311.3 131.32c-20.71-6.1-25.33-31.03-15.75-48.52 6.58-12.37 23.9-21.81 37.06-14.28 8.66 4.69 17.43 10.14 22.88-1.83 9.58-19.2-16.9-32.2-32.25-23.69-4.38 2.33-7.69 6.25-11.94 8.82-36.82 15.85-41.29-41.48 18.87-26.55 15.78 2.6 34.04 9.52 40.53 25.4 3.3 8.65 1.64 19.24 3.94 28.38 4.6 21.12 19.04 11.02 29.9 17.12 15.02 11.18.16 35.3-16.6 32.3-17.86 1.15-8.49-22.09-23.7-19.81-21.3 8.64-15.81 32.6-52.94 22.66ZM335 105.36c32.23-5.63 4.62-32.14-12.26-15.3-6 8.58 3.3 17.84 12.26 15.3"
      />
      <path
        fill="#fff"
        d="M284.44 81.67c-5.5 6.32-1.71 16.6-.49 24.02 1.7 14.94-8.98 28.9-22.62 34.2-23.56 5.82-37.84-11.2-26.44-32.98.27-8.03-9.7-14.46-11.73-3.44-1.6 8.67-8.93 14.48-17.58 15.04-16.13.55-23.13-21.46-15.38-33.63 4.57-9.07 17.9-15.07 15.37-26.7-17.07-31.41 35.24-39.28 26.19-4.62-4.03 11.54-27.48 15.68-17.25 30.57 7.07 7.12 19.9-.57 24.14-7.76 7.88-10.42.15-27.38 10.22-36.47 9.94-10.22 22.8 1.99 19.58 13.43-1.48 14.6-24.54 14.3-22.7 36.32-.66 12.83 11.73 20.04 21.68 11.4 12.2-11.83.98-23.52 3.7-35.08 5.43-21.6 40.53-3.96 13.3 15.7ZM158.35 136.07c-8.85-.4-15.37-8.56-15.34-17.07 1.68-9.2 10.75-14.57 13.54-23.3 1.67-5.44-2.35-10.19-3.47-15.28-2.4-8.44 4.27-15.32 12.37-16.19 8.67-2.82 17.6 2.48 14.88 12.37-1.36 5.44-8.92 8.5-7.77 14.93 1.24 8.43 10.35 11.71 9.6 21.1.78 12.58-10.67 25.7-23.81 23.44ZM143.8 175.56c4.26 1.35 8.48-2.53 12.78-3.33 5.52-2.68 13.3 3.53 9.28 9.1-4.4 4.02-12.32 3.94-17.07.6-5.56-3.83-9.76.5-14.92 2.04-7.17 1.63-11.07-5.8-9.77-11.94 1.44-4.33 6.53-7.45 9.27-10.8 6.17-4.29-1.28-19.27 9.08-18.02 9.95 6.66 6.69 4.45 18.28 1.56 12-2 12.16 14.65.45 13.14-4.88-2.1-9.77-7.86-15-2.61-2.78 3.08-.35 6.86 3.6 5.52 4.06-2 10.9.3 9.05 5.67-2.85 6.35-9.56 1.68-14.28 1.18-6.45.64-6.16 5.44-.75 7.89ZM108.14 163.26c4.14 28.2-30.32 16.39-15.87.88 2.33-2.45 5.7-3.65 6.93-7.03.98-3.72-1.81-6.57-5.93-6.2-3.25-.31-7.73.68-9.83-2.3-3.15-3.9-2.52-10.88 2.95-12.34 9-3.22 13.85 9.72 23.15 8.67 5.82-.24 11.55-7.03 17.49-3.71 4.27 1.9 6.31 9.8 3.07 14.17-3.63 5.43-9.99 5.16-14.65 1.38-4.44-2.16-7.4 2.36-7.3 6.48M197.08 179.71c3.84-5.68-6.89-10-9.84-4.94-5.3 15.97-18.47 13.81-13.98 2.63 3.04-5.32 7.01-11.29 5.78-17.7-3.07-6.25-2.06-13.27 6.13-13.76 6.9.17 15.51-1.56 21.37 3.74 6.95 5.96-.7 14.13-8.14 13.67-1.13-.03-4.87.21-4.22 1.53.39.66 1.66 1.08 2.45 1.3 7.89 1.64 14.83 7.7 12.43 16.46-1.87 7.55-20.1 5.88-11.98-2.93Zm-.5-23.56c.86-3.86-5.66-4.96-7.8-2.08-2.87 4.57 6.5 5.08 7.8 2.08M368.46 158.92c4.8-5.69 14.25-2.16 11.49 5.6-3.15 8.3-12.04 3.8-17.89 7.41-2.43 1.48-3.98 3.96-6.23 5.7-8.56 6.45-15.65-2.34-10.66-10.9 5.08-15.46-17.44-16.36-7.02-25.18 2.31-1.33 5.16-.4 7.83-1.36 5.09-1.07 8.3-6.95 13.08-7.75 7.8-1.05 11.04 7.2 2.5 10.2-4.31.47-14.9 2.06-9.56 8.27 6.25 3.48 9.69-12.11 17.47-3.36 3.2 8.72-9.76 6.88-13.32 11.6-1.42 2.43.68 6.07 3.4 6.41 3.56.32 6.36-4.26 8.9-6.64ZM245.1 191.87c-4.66-1.36-4.3-4.73-4.28-8.8-.85-4.3-10.68-11.53-12.88-5.59-.05 2.31 1.77 4.45 1.49 6.84-.84 5.7-10.3 8.02-13.82 3.4-3.05-5.17 5.28-6.22 2.64-20.28-1.74-11.9 4.65-22.84 17.7-17.91 4.05.67 9.27 1.46 11.69 5.05 5.1 6.36-1.16 13.84-8.4 13.66-10.6.77 10.5 5.76 11.54 10.26 4.32 4.7 2.09 15.36-5.68 13.37Zm-7.84-29.88c2.51-5.1-6.72-5.91-8.48-3.25-1.3 4.52 5.9 4.98 8.48 3.24M190.1 39.04c-.7 10.78-10.9 19.99-21.52 15.2-13.7-7.75-5.38-26.74 6.28-32.73 7.79-4.9 27.4-4.9 33.86 1.94 2.02 4.42-14.13-1.68-18.63 15.59Z"
      />
      <path
        fill="#fff"
        d="M336.11 167.67c4.87 5.51-1.97 14.15-7.04 17.15-11.51 7.12-27.71-1.41-29.16-14.58.45-5.25-1.72-13.49 2.37-18.1 8.53-14.7 39.65-9.1 29.36 7.44-3.7 3.26-7.86 2.38-10.2-1.8-4.13-9.87-14.09.33-12.84 7.5-.47 7.1 7.49 15.06 14.38 10.8 3.41-2.24 1.56-8.8 5.51-10.5 2.38-1.21 5.53-.1 7.62 2.09M280.66 176.02c-2.93-1.46-6.6.12-9.02 2-3.71 2.85 2.9 7.6-3.26 11.08-4.86 2.63-14.34.27-12.01-6.61 3.81-4.9 6.09-10.32 7.64-16.36 8.82-23.69 16.99-19.44 26.85.6 1.48 2.92 2.18 6.3 4.39 8.8 1.84 2.17 3.38 1.7 4.23 4.1 3.87 8.16-6.81 15.2-13.38 10.11-4.54-3.55.98-11.68-5.44-13.72m-.94-9.22c2.25-6.06-4.91-8.72-7.18-2.87-.42 3.54 5.02 6 7.18 2.87"
      />
    </svg>
  );
}

function MizuIcon({ className }: { className?: string }) {
  return (
    <svg className={cn("size-16", className)} viewBox="0 0 40 41.938">
      <path
        d="M17.582,41.938c-.361,0-.73-.027-1.097-.081-2.682-.391-5.119-1.91-6.686-4.168-1.288-1.857-1.585-4.125-.878-6.035-.604.15-1.222.228-1.838.228h0c-2.754,0-5.187-1.471-6.508-3.933-.697-1.301-.766-2.979-.18-4.378.442-1.055,1.193-1.785,2.114-2.055.227-.066.463-.1.703-.1.862,0,1.529.409,2.175.806.638.391,1.296.795,2.076.795.408,0,.836-.104,1.31-.318.876-.397,2.217-1.962,1.629-1.824-.403.095-2.042.541-3.041.541-2.096,0-3.939-.775-5.332-2.242C.48,17.54-.13,15.426.356,13.372c.426-1.805,1.795-3.375,3.662-4.2.975-.431,2.084-.658,3.209-.658,2.938,0,5.771,2.645,4.916,1.464-1.372-1.895-1.694-4.389-.821-6.354C12.298,1.424,14.627.036,17.401,0h.113c1.577,0,2.814.41,4.187,1.026,3.669,1.649,5.926,4.911,5.955,8.567,1.192-.799,2.633-1.214,3.886-1.214,1.152,0,2.18.327,2.973.946,1.317,1.03,1.927,2.917,1.631,5.047-.348,2.501-2.022,5.703-5.678,7.193-.355.145-.648.287-.879.428,1.524.733,2.798.748,4.138.764,1.197.014,2.435.028,3.744.543,1.634.641,2.602,2.327,2.525,4.401-.081,2.23-1.341,4.199-3.37,5.267-1.025.54-2.133.814-3.291.814h0c-2.105,0-4.208-.935-5.768-2.564-1.389-1.453-2.056-3.14-2.67-4.886-.124-.354-.378-.73-.72-.73-.05,0-.104.007-.163.021-.229.055-.6.428-.516.871.221,1.163.62,2.336,1.042,3.576l.082.243c1.089,3.206.563,6.526-1.406,8.882-1.479,1.768-3.479,2.74-5.634,2.74Z"
        fill="#e6e4e780"
      />
      <path
        d="M37.997,27.63c.039-1.065-.324-2.1-1.257-2.467-2.413-.947-4.964.393-8.643-1.693-.716-.406-1.156-1.515-.632-2.23s1.399-1.18,2.247-1.525c4.527-1.845,5.493-7.309,3.571-8.812-1.617-1.264-5.183-.107-5.945,2.09l-1.34,3.86c-.274.79-1.104,1.292-1.821,1.225-.732-.069-1.405-.752-1.547-1.588-.447-2.621,2.952-4.098,3.023-6.628.09-3.187-1.97-5.752-4.772-7.011-1.143-.514-2.153-.868-3.455-.851-1.719.022-3.535.764-4.277,2.434-.603,1.357-.311,3.094.613,4.369,4.12,5.687,5.729,12.877,3.874,19.71-.529,1.951-2.512,3.158-4.287,2.465-.781-.305-1.505-.301-2.064.462-1.088,1.484-.923,3.549.158,5.107,1.227,1.769,3.184,3.016,5.332,3.33,1.958.286,3.657-.47,4.907-1.964,1.601-1.915,1.857-4.572,1.047-6.956-.464-1.366-.933-2.706-1.195-4.089-.285-1.502.754-2.887,2.014-3.189,1.455-.349,2.724.534,3.236,1.99.536,1.523,1.09,2.978,2.227,4.167,1.75,1.83,4.415,2.558,6.682,1.364,1.324-.697,2.245-1.957,2.303-3.571ZM10.127,29.011c1.963-1.177,3.323-2.951,4.439-4.853,1.651-2.817,2.123-7.733-1.262-8.727-1.244-.365-1.944-1.254-2.255-2.484-.65-2.568-4.076-2.894-6.222-1.946-1.31.579-2.25,1.669-2.524,2.83-.353,1.493.163,2.895,1.178,3.964,1.848,1.946,4.633,2.01,7.042.869.338-.16,1.172-.133,1.456.069,1.312.935.343,4.553-2.379,5.786-3.648,1.653-5.543-1.372-6.527-1.084-.881.258-1.482,2.172-.734,3.567,1.511,2.818,4.924,3.725,7.789,2.008Z"
        fill="#57b2cd"
      />
    </svg>
  );
}
